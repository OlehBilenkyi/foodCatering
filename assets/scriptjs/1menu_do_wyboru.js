
let e=[];const t=()=>{const t=document.getElementById("package-count"),a=document.getElementById("total-without-discount");t&&a&&(t.textContent=e.join(", "),a.textContent=e.length)};document.addEventListener("click",(function(i){const r=i.target.closest(".remove-package");if(r){const i=r.closest(".pay-widget");if(i){const r=i.querySelector('input[name^="selected-date"]');if(r){const t=r.value;e=e.filter((e=>e!==t))}return i.remove(),a.saveOrderDataToStorage(),void t()}}const s=i.target.closest(".remove-category");if(s){const e=s.closest(".additional-category");e&&(e.remove(),a.saveOrderDataToStorage(),t())}})),document.querySelectorAll(".pay-widget section[data-category]").forEach((e=>{}));class a{static saveOrderDataToStorage(){const e={dates:{},totalPrice:0};document.querySelectorAll(".pay-widget").forEach((t=>{const a=t.querySelector('[name^="selected-date"]'),i=a?a.value.trim():"";i&&(e.dates[i]||(e.dates[i]={sniad:[],obiad:[],kolacja:[]}),["sniad","obiad","kolacja"].forEach((a=>{this.getCleanedSectionData(t,a).forEach((t=>{e.dates[i][a].some((e=>e.value===t.value&&e.weight===t.weight&&e.price===t.price))||e.dates[i][a].push(t)}))})))})),e.totalPrice=this.calculateTotalPrice(e),sessionStorage.setItem("orderData",JSON.stringify(e)),setTimeout((()=>{this.updateTotalInfo(),this.updateOrderSummary()}),100)}static getCleanedSectionData(e,t){return this.getSectionData(e,t).filter((e=>""!==e.value.trim()&&parseFloat(e.weight)>0)).filter(((e,t,a)=>t===a.findIndex((t=>t.value===e.value&&t.weight===e.weight&&t.price===e.price))))}static getSectionData(e,t){const a=[];return e.querySelectorAll(".pay-widget__row").forEach((e=>{const i=e.querySelector(`input[id^="hidden-${t}"][name^="hidden-${t}-menu-item-pay-full-card"]`);if(!i)return;const r=e.querySelector(`input[id^="hidden-${t}-data-weight"]`),s=e.querySelector(`input[id^="hidden-${t}-data-price"]`),n=e.querySelector(`input[name^="selected_${t}_menu_options_id"]`);a.push({value:i.value.trim()||"Nie wybrano",weight:r?r.value:"0",price:s?parseFloat(s.value):0,menu_options_id:n?n.value:""})})),a}static calculateTotalPrice(e){let t=0;return Object.values(e.dates).forEach((e=>{Object.values(e).flat().forEach((e=>{t+=parseFloat(e.price)||0}))})),t.toFixed(2)}static getOrderData(){return JSON.parse(sessionStorage.getItem("orderData"))||{dates:{}}}static updateTotalInfo(){const e=document.querySelector(".total-info__grid.menu_do_wyboru");if(!e)return;const t=this.getOrderData();let a=Object.keys(t.dates).join(", ")||"Nie wybrano";const i=this.calculateTotalPrice(t);e.innerHTML=`\n        <p><strong>Razem do zapłaty:</strong> <span style="color: #006A23; font-weight: bold;">${i} zł</span></p>\n        <p><strong>Wybrane daty:</strong> <span>${a}</span></p>\n    `;const r=document.getElementById("total-price");r&&(r.textContent=`${i} zł`)}static updateOrderSummary(){const e=document.getElementById("order-summary");if(!e)return;const t=this.getOrderData();let a="";Object.entries(t.dates).forEach((([e,t])=>{(t.sniad.length||t.obiad.length||t.kolacja.length)&&(a+=`\n                    <div class="order-summary-block">\n                        <p><strong>Data: ${e}</strong></p>\n                        ${this.renderCleanedCategories("Śniadanie",t.sniad)}\n                        ${this.renderCleanedCategories("Obiad",t.obiad)}\n                        ${this.renderCleanedCategories("Kolacja",t.kolacja)}\n                        <p><strong>Razem za dzień: ${this.calculateDayTotal(t)} zł</strong></p>\n                    </div>\n                    <hr>\n                `)})),e.innerHTML=a||"<p>Brak danych o zamówieniu.</p>"}static renderCleanedCategories(e,t){if(!t.length)return"";let a=`<p><strong>${e}:</strong></p><ul>`;return t.forEach((e=>{a+=`<li>${e.value} (${e.weight}g) - ${e.price.toFixed(2)} zł</li>`})),a+"</ul>"}static calculateDayTotal(e){return Object.values(e).flat().reduce(((e,t)=>e+(parseFloat(t.price)||0)),0).toFixed(2)}static resetOrderData(){sessionStorage.removeItem("orderData"),this.updateTotalInfo(),this.updateOrderSummary()}}document.addEventListener("change",(function(e){e.target.matches(".pay-widget .air-datepicker input")&&a.saveOrderDataToStorage()})),document.addEventListener("DOMContentLoaded",(()=>{a.updateTotalInfo(),a.updateOrderSummary()}));class i{constructor(e,t){this.category=e,this.section=t,this.buttons=t.querySelectorAll(".pay-item__btn"),this.menuItems=t.querySelectorAll(`.menu-items_${e} .menu-item`),this.fieldWeight=t.querySelector(`input[id^="hidden-${e}-data-weight"]`),this.fieldPrice=t.querySelector(`input[id^="hidden-${e}-data-price"]`),this.hiddenDishField=t.querySelector(`input[id^="hidden-${e}"][name^="hidden-${e}-menu-item-pay-full-card"]`),this.fieldWeight&&this.fieldPrice&&this.hiddenDishField&&this.buttons.length&&this.menuItems.length&&this.init()}init(){this.resetState(),this.buttons.forEach((e=>{e.addEventListener("click",(()=>{this.selectWeight(e),this.syncOrderManager(),r.updateAcceptCheckboxState()}))})),this.menuItems.forEach((e=>{e.addEventListener("click",(()=>{this.selectMenuCard(e),this.syncOrderManager(),r.updateAcceptCheckboxState()}))}))}resetState(){this.buttons.forEach((e=>e.classList.remove("active"))),this.menuItems.forEach((e=>{e.classList.remove("selected"),e.classList.add("disabled")})),this.fieldWeight.value="0",this.fieldPrice.value="0",this.hiddenDishField.value=""}selectWeight(e){this.buttons.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),this.fieldWeight.value=e.dataset.weight||"0",this.fieldPrice.value=e.dataset.price||"0",this.menuItems.forEach((e=>e.classList.remove("disabled"))),this.syncOrderManager()}selectMenuCard(e){if(e.classList.contains("disabled"))return;this.menuItems.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected");const t=e.querySelector(".menu-card__heading h6")?.textContent||"";this.hiddenDishField.value=t,this.syncOrderManager()}syncOrderManager(){a.updateTotalInfo(),a.saveOrderDataToStorage(),a.updateOrderSummary()}isComplete(){return"0"!==this.fieldWeight.value.trim()&&"0"!==this.fieldPrice.value.trim()&&[...this.menuItems].some((e=>e.classList.contains("selected")))}}class r{static categories=[];static addCategory(e,t){const a=new i(e,t);a.fieldWeight&&a.fieldPrice&&a.hiddenDishField&&this.categories.push(a)}static updateAcceptCheckboxState(){const e=document.querySelectorAll(".pay-widget section[data-category]");let t=!0;e.forEach((e=>{const a=e.dataset.category,i=this.categories.find((t=>t.category===a&&t.section===e));if(i){i.isComplete()||(t=!1)}else this.addCategory(a,e),t=!1}));const a=document.getElementById("accept"),i=document.querySelector(".accept-terms");a&&i&&(t?(a.removeAttribute("disabled"),i.classList.remove("disabled")):(a.setAttribute("disabled","true"),i.classList.add("disabled")))}static duplicateSection(e){const t=e.cloneNode(!0),a=`${Date.now()}-${Math.random().toString(36).substring(2,8)}`;t.querySelectorAll("[id]").forEach((e=>{e.id=`${e.id}-${a}`})),t.querySelectorAll("[name]").forEach((e=>{const t=e.getAttribute("name")||"";t.startsWith("selected-date")?e.setAttribute("name",`selected-date-${a}`):e.setAttribute("name",`${t}-${a}`)})),t.querySelectorAll('input[type="hidden"]').forEach((e=>{e.value=""})),t.querySelectorAll(".pay-item__btn").forEach((e=>e.classList.remove("active"))),t.querySelectorAll(".menu-item").forEach((e=>{e.classList.remove("selected"),e.classList.add("disabled")})),t.classList.add("additional-category"),e.insertAdjacentElement("afterend",t);const r=e.dataset.category;r&&(new i(r,t),this.updateAcceptCheckboxState())}static initializeAddFoodButtons(e){e.querySelectorAll(".add-food [data-add-category]").forEach((t=>{t.addEventListener("click",(()=>{const a=e.closest(`section[data-category="${t.dataset.addCategory}"]`);a&&this.duplicateSection(a)}))}))}static initializeCalendar(e){const t=e.querySelector(".calendar-container #delivery-calendar");t&&!t.dataset.initialized&&(n(t,e),t.dataset.initialized="true")}}class s{constructor(e,t){this.container=document.querySelector(e),this.template=document.querySelector(t),this.blockCounter=0,this.container&&this.template&&this.init()}init(){this.addInitialBlock(),document.querySelector(".pay-widget__moreV2").addEventListener("click",(()=>this.addNewBlock())),this.observer=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.length>0&&e.addedNodes.forEach((e=>{e.classList&&e.classList.contains("pay-widget")&&this.initializeComponents(e)}))}))})),this.observer.observe(this.container,{childList:!0,subtree:!0}),document.querySelector(".pay-widget-container").addEventListener("click",(e=>{if(e.target.matches(".add-food [data-add-category]")){const t=e.target.dataset.addCategory,a=e.target.closest(`section[data-category="${t}"]`);a&&r.duplicateSection(a)}}))}addInitialBlock(){const e=this.template.content.cloneNode(!0);this.container.appendChild(e),this.initializeComponents(e)}addNewBlock(){const e=this.template.content.cloneNode(!0);this.blockCounter++,this.updateAttributes(e,this.blockCounter),this.container.appendChild(e),this.initializeComponents(e),a.saveOrderDataToStorage()}updateAttributes(e,t){e.querySelectorAll("[id]").forEach((e=>{e.id=`${e.id}-${t}`})),e.querySelectorAll("[name]").forEach((e=>{const a=e.getAttribute("name")||"";a.startsWith("selected-date")?e.setAttribute("name",`selected-date-${t}`):e.setAttribute("name",`${a}-${t}`)}))}initializeComponents(e){e.querySelectorAll("section[data-category]").forEach((e=>{const t=e.dataset.category;t&&new i(t,e)}));const t=e.querySelector('.calendar-container div[id^="delivery-calendar"]');t&&!t.dataset.initialized&&(n(t,e),t.dataset.initialized="true"),r.updateAcceptCheckboxState()}}const n=(i,r=null)=>{if(!i)return;const s=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),o=()=>{const e=new Date(n);return s.getHours()>=21?e.setDate(n.getDate()+2):e.setDate(n.getDate()+1),e};new AirDatepicker(i,{locale:{days:["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],daysMin:["Nd","Pn","Wt","Śr","Czw","Pt","So"],months:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],monthsShort:["Sty","Lut","Mar","Kwi","Maj","Cze","Lip","Sie","Wrz","Paź","Lis","Gru"]},minDate:o(),isDisabled:e=>e<o()||(6===e.getDay()||0===e.getDay()),multipleDates:!1,range:!1,onSelect({date:r}){if(r){const s=i.closest(".pay-widget"),n=s.querySelector('input[name^="selected-date"]');if(n){const i=r.toLocaleDateString("pl-PL",{day:"2-digit",month:"2-digit",year:"numeric"});n.value=i;const o=s.querySelector(".pay-full-card__dates");o&&(o.textContent=i);((i,r)=>{const s=i.toLocaleDateString("pl-PL",{day:"2-digit",month:"2-digit",year:"numeric"});e[r]=s;const n=a.getOrderData();n.dates[s]||(n.dates[s]={sniad:[],obiad:[],kolacja:[]}),sessionStorage.setItem("orderData",JSON.stringify(n)),t()})(r,Array.from(document.querySelectorAll(".pay-widget")).indexOf(s)),a.saveOrderDataToStorage()}}}})};document.addEventListener("DOMContentLoaded",(()=>{new s(".pay-widget-container","#menu-widget-template"),r.updateAcceptCheckboxState(),a.updateTotalInfo(),a.updateOrderSummary();const e=document.querySelector("#delivery-calendar");e&&n(e);const t=document.getElementById("accept-label"),i=document.getElementById("accept");t&&i&&t.addEventListener("click",(function(e){i.disabled&&(e.preventDefault(),function(e){const t=document.getElementById("error-message");t?(t.textContent=e,t.style.display="block",setTimeout((()=>{t.style.display="none"}),3e3)):alert(e)}("Najpierw wybierz wszystkie dania na stronie"))}))})),document.querySelectorAll(".steps-line__item").forEach(((e,t)=>{e.addEventListener("click",(()=>{2===t&&a.updateOrderSummary()}))}));const o=new MutationObserver((e=>{e.forEach((e=>{if("class"===e.attributeName){e.target.classList.contains("active")&&a.updateOrderSummary()}}))}));document.querySelectorAll(".page-grid__tab").forEach((e=>{o.observe(e,{attributes:!0})})),document.addEventListener("click",(e=>{const t=e.target.closest(".menu-item.pay-full-card");if(!t)return;const a=t.closest("section[data-category]");if(!a)return;const i=a.querySelector("input.selected-menu-options-id");if(!i)return;a.querySelectorAll(".menu-item.pay-full-card").forEach((e=>e.classList.remove("selected"))),t.classList.add("selected");const r=t.getAttribute("data-menu-options-id")||"";i.value=r}));
